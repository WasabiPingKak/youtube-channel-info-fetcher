
# youtube_channel_import.py ä½¿ç”¨èªªæ˜

## âœ… ç°¡ä»‹

æœ¬å·¥å…·å¯**è‡ªå‹•è®€å– YouTube é »é“ç¶²å€æ¸…å–®**ï¼Œè§£æç‚ºé »é“ IDï¼Œä¸¦åŒæ­¥æ›´æ–° Firestore ä¸­çš„é »é“è³‡è¨Šèˆ‡é »é“ç´¢å¼•ã€‚
æ•´åˆè§£æã€å¿«å–ã€API æ“·å–èˆ‡è³‡æ–™å¯«å…¥ï¼Œä¸€éµå®Œæˆã€‚
æ¨¡çµ„åŒ–è¨­è¨ˆï¼Œç¶­è­·ç°¡å–®ï¼Œ**æœ€å°åŒ– API è«‹æ±‚èˆ‡ Firestore å¯«å…¥æˆæœ¬**ã€‚

---

## ğŸ“‚ å¿…è¦æª”æ¡ˆ

| æª”æ¡ˆåç¨±              | èªªæ˜                                           |
|-----------------------|------------------------------------------------|
| `.env.local`          | ç’°å¢ƒè®Šæ•¸è¨­å®šï¼Œéœ€åŒ…å« `API_KEY` èˆ‡ `FIREBASE_KEY_PATH` |
| `channel_list_handle.txt` | æ¯è¡Œä¸€å€‹é »é“ç¶²å€ï¼Œå¯ç‚º `@handle` æˆ– `channel/UCxxxx` |
| `handle_cache.json`   | è‡ªå‹•ç”Ÿæˆèˆ‡æ›´æ–°çš„ handle-to-ID å°ç…§å¿«å–ï¼ˆé¸å¡«ï¼‰   |

---

## âš™ï¸ åŸ·è¡Œæµç¨‹èªªæ˜

### 1. è¼‰å…¥ handle æ¸…å–®èˆ‡å¿«å–

- è®€å– `channel_list_handle.txt`
- ä½¿ç”¨æ­£è¦è¡¨é”å¼è§£æå‡º UCID æˆ– @handle
- å„ªå…ˆæŸ¥æ‰¾ `handle_cache.json`ï¼Œæ¸›å°‘ API æ¬¡æ•¸
- æœªå‘½ä¸­å¿«å–çš„ @handle æœƒå‘¼å« YouTube API æŸ¥è©¢ï¼Œä¸¦å³æ™‚æ›´æ–°å¿«å–

### 2. æŸ¥è©¢é »é“è³‡è¨Š

- ä½¿ç”¨ YouTube Data API æŸ¥è©¢ï¼š
  - `name`ï¼ˆé »é“åç¨±ï¼‰
  - `thumbnail`ï¼ˆé ­åƒç¶²å€ï¼‰

### 3. å¯«å…¥ Firestore

- å¯«å…¥ `channel_data/{channel_id}/channel_info/info`
  - åªåœ¨è³‡æ–™æœ‰è®Šæ›´æ™‚æ‰æœƒæ›´æ–°ï¼ˆé¿å…ä¸å¿…è¦çš„å¯«å…¥ï¼‰
  - è‡ªå‹•å¡«å…¥ `updatedAt = SERVER_TIMESTAMP`
- å»ºç«‹æˆ–æ›´æ–° `channel_index/{channel_id}`
  - åŒ…å« `name`ã€`thumbnail`ã€`url`ã€`enabled`ã€`priority`
- è‹¥ `channel_data/{channel_id}/settings/config` å°šæœªå­˜åœ¨ï¼Œå‰‡è‡ªå‹•å¾ `config_default.json` åˆå§‹åŒ–åˆ†é¡è¨­å®š

---

## ğŸ§¹ åƒæ•¸èªªæ˜

| åƒæ•¸       | èªªæ˜                                                   |
|------------|--------------------------------------------------------|
| `--force`  | å¼·åˆ¶é‡æ–°å¯«å…¥ Firestore è³‡æ–™ï¼Œå³ä½¿å…§å®¹ç„¡è®ŠåŒ–ä¹Ÿæœƒæ›´æ–° |

---

## ğŸ§¾ åŸ·è¡Œçµæœè¼¸å‡º

- åŸ·è¡ŒçµæŸå¾Œï¼š
  - **çµ‚ç«¯åˆ—å°**ï¼šæˆåŠŸèˆ‡å¤±æ•—çš„é »é“æ¸…å–®èˆ‡ç¸½æ•¸
  - **log æª”**ï¼š`youtube_channel_import.log`ï¼ŒåŒ…å«è©³ç´°è™•ç†éç¨‹èˆ‡éŒ¯èª¤ç´€éŒ„

---

## ğŸ› ï¸ åŸ·è¡Œæ–¹å¼

```bash
# å®‰è£ä¾è³´å¥—ä»¶
pip install -r requirements.txt

# åŸ·è¡Œï¼ˆè‡ªå‹•åˆ¤æ–·å“ªäº›éœ€è¦æ›´æ–°ï¼‰
python youtube_channel_import.py

# å¼·åˆ¶å…¨éƒ¨æ›´æ–°ï¼ˆä¸ç®¡æœ‰ç„¡è®Šæ›´ï¼‰
python youtube_channel_import.py --force
```

---

## ğŸ“œ æ³¨æ„äº‹é …

- `channel_list_handle.txt` æ˜¯å¿…è¦æª”æ¡ˆï¼Œæœªæä¾›å°‡ä¸­æ­¢åŸ·è¡Œ
- `handle_cache.json` ç‚ºå¿«å–æ©Ÿåˆ¶ï¼Œè‡ªå‹•ç”Ÿæˆèˆ‡æ›´æ–°ï¼Œè«‹å‹¿æ‰‹å‹•ç·¨è¼¯
- å³ä½¿éƒ¨åˆ†é »é“è§£æå¤±æ•—ï¼Œä¹Ÿä¸æœƒä¸­æ­¢æ•´é«”æµç¨‹ï¼Œçµæœå°‡è¨˜éŒ„æ–¼ log ä¸­

---

## ğŸ“ ç›®éŒ„ç¯„ä¾‹

```plaintext
youtube_tools/
â”œâ”€â”€ youtube_channel_import.py          # ä¸»ç¨‹å¼
â”œâ”€â”€ channel_list_handle.txt            # é »é“ç¶²å€æ¸…å–®
â”œâ”€â”€ handle_cache.json                  # å¿«å–ï¼ˆè‡ªå‹•ç”¢ç”Ÿï¼‰
â”œâ”€â”€ youtube_channel_import.log         # logï¼ˆè‡ªå‹•ç”¢ç”Ÿï¼‰
â”œâ”€â”€ .env.local                         # API é‡‘é‘°èˆ‡é‡‘é‘°è·¯å¾‘
â”œâ”€â”€ config_default.json                # é è¨­åˆ†é¡è¨­å®šï¼ˆè‡ªå‹•å¯«å…¥ settings/configï¼‰
â”œâ”€â”€ core/                              # ç¨‹å¼æ¨¡çµ„
â”‚   â”œâ”€â”€ constants.py
â”‚   â”œâ”€â”€ env.py
â”‚   â”œâ”€â”€ log_setup.py
â”‚   â”œâ”€â”€ youtube_api.py
â”‚   â”œâ”€â”€ firestore_writer.py
â”‚   â”œâ”€â”€ handle_utils.py
â”‚   â””â”€â”€ config_initializer.py
```
